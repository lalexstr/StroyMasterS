import{_ as f,j as n,k as P,a as l,b as o,l as u,v as m,m as _,c as A,p as S,t as p,q as I,o as s,F as L,g as D,e as g,s as N,u as w,d as b,w as x,r as v,i as V}from"./index-BIMe63PN.js";const X={data(){return{product:{name:"",description:"",price:0,category_id:1,manufacturer_id:1,photos:[]},loading:!1}},methods:{handleFileUpload(e){this.product.photos=Array.from(e.target.files)},async handleSubmit(){var e;if(!this.loading){this.loading=!0;try{n.Loading.circle("Добавление продукта...");const t=new FormData;t.append("name",this.product.name),t.append("description",this.product.description),t.append("price",this.product.price.toString()),t.append("category_id",this.product.category_id.toString()),t.append("manufacturer_id",this.product.manufacturer_id.toString()),this.product.photos.forEach(c=>{t.append("photos",c)});const a=await P.post("http://localhost:3000/api/products",t,{headers:{"Content-Type":"multipart/form-data"}});n.Notify.success("Продукт успешно добавлен"),this.$emit("product-added"),this.resetForm()}catch(t){console.error("Add product error:",t);let a="Не удалось добавить продукт";t.response&&(t.response.status===404?a="URL API не найден. Проверьте адрес сервера.":a=((e=t.response.data)==null?void 0:e.message)||a),n.Notify.failure(a)}finally{this.loading=!1,n.Loading.remove()}}},resetForm(){this.product={name:"",description:"",price:0,category_id:1,manufacturer_id:1,photos:[]},this.$nextTick(()=>{const e=this.$el.querySelector('input[type="file"]');e&&(e.value="")})}}},C={class:"add-product-form"},U={class:"form-group"},q=["disabled"],F={class:"form-group"},B=["disabled"],M={class:"form-group"},T=["disabled"],E={class:"form-group"},$=["disabled"],j={class:"form-group"},R=["disabled"],z={class:"form-group"},G=["disabled"],H={key:0,class:"file-list"},J=["disabled"],K={key:0},O={key:1};function Q(e,t,a,c,d,r){return s(),l("div",C,[t[15]||(t[15]=o("h3",null,"Добавить новый продукт",-1)),o("form",{onSubmit:t[6]||(t[6]=I((...i)=>r.handleSubmit&&r.handleSubmit(...i),["prevent"]))},[o("div",U,[t[7]||(t[7]=o("label",null,"Название:",-1)),u(o("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>d.product.name=i),type:"text",required:"",disabled:d.loading},null,8,q),[[m,d.product.name]])]),o("div",F,[t[8]||(t[8]=o("label",null,"Описание:",-1)),u(o("textarea",{"onUpdate:modelValue":t[1]||(t[1]=i=>d.product.description=i),disabled:d.loading},null,8,B),[[m,d.product.description]])]),o("div",M,[t[9]||(t[9]=o("label",null,"Цена:",-1)),u(o("input",{"onUpdate:modelValue":t[2]||(t[2]=i=>d.product.price=i),type:"number",step:"0.01",required:"",disabled:d.loading},null,8,T),[[m,d.product.price]])]),o("div",E,[t[11]||(t[11]=o("label",null,"Категория:",-1)),u(o("select",{"onUpdate:modelValue":t[3]||(t[3]=i=>d.product.category_id=i),required:"",disabled:d.loading},t[10]||(t[10]=[A('<option value="1" data-v-00cd82b0>Экскаватор на гусеничном ходу</option><option value="2" data-v-00cd82b0>Экскаватор на колесном ходу</option><option value="3" data-v-00cd82b0>Самосвал</option><option value="4" data-v-00cd82b0>Фронтальный погрузчик</option><option value="5" data-v-00cd82b0>Автокран «Урал»</option><option value="6" data-v-00cd82b0>Автобетоносмесители</option><option value="7" data-v-00cd82b0>Грузовой тягач</option><option value="8" data-v-00cd82b0>Грузовой тягач с полуприцепом</option><option value="9" data-v-00cd82b0>Доставка и вывоз экскаватора</option><option value="10" data-v-00cd82b0>Грузовик бортовой с гидроманипулятором</option><option value="11" data-v-00cd82b0>Грузовой фургон «бабочка»</option><option value="12" data-v-00cd82b0>Илосос</option><option value="13" data-v-00cd82b0>Вкручивание винтовых свай</option><option value="14" data-v-00cd82b0> Автовышка на базе автокрана</option><option value="15" data-v-00cd82b0>Скальник, сланец</option><option value="16" data-v-00cd82b0>ПГС</option><option value="17" data-v-00cd82b0>Песок речной</option><option value="18" data-v-00cd82b0>Песок амурский</option><option value="19" data-v-00cd82b0>Щебень</option><option value="20" data-v-00cd82b0>Отсев</option><option value="21" data-v-00cd82b0>Глина</option>',21)]),8,$),[[_,d.product.category_id]])]),o("div",j,[t[13]||(t[13]=o("label",null,"Производитель:",-1)),u(o("select",{"onUpdate:modelValue":t[4]||(t[4]=i=>d.product.manufacturer_id=i),required:"",disabled:d.loading},t[12]||(t[12]=[o("option",{value:"1"},"СтройМастер",-1)]),8,R),[[_,d.product.manufacturer_id]])]),o("div",z,[t[14]||(t[14]=o("label",null,"Фотографии:",-1)),o("input",{type:"file",multiple:"",onChange:t[5]||(t[5]=(...i)=>r.handleFileUpload&&r.handleFileUpload(...i)),accept:"image/*",required:"",disabled:d.loading},null,40,G),d.product.photos.length>0?(s(),l("div",H," Выбрано файлов: "+p(d.product.photos.length),1)):S("",!0)]),o("button",{type:"submit",class:"submit-btn",disabled:d.loading},[d.loading?(s(),l("span",O,"Отправка...")):(s(),l("span",K,"Добавить продукт"))],8,J)],32)])}const W=f(X,[["render",Q],["__scopeId","data-v-00cd82b0"]]),Y={props:{products:{type:Array,required:!0,validator:e=>Array.isArray(e)}},data(){return{deletingId:null}},methods:{confirmDelete(e){n.Confirm.show("Удаление продукта","Вы уверены, что хотите удалить этот продукт?","Да","Нет",()=>this.emitDelete(e),()=>n.Notify.info("Удаление отменено"))},emitDelete(e){this.deletingId=e,this.$emit("product-deleted",e),this.deletingId=null}}},Z={class:"product-list"},tt={class:"product-info"},ot={class:"product-actions"},et=["onClick","disabled"],dt={key:0},it={key:1};function nt(e,t,a,c,d,r){return s(),l("div",Z,[(s(!0),l(L,null,D(a.products,i=>(s(),l("div",{key:i.id,class:"product-item"},[o("div",tt,[o("h4",null,p(i.name),1),o("p",null,p(i.description),1),o("p",null,[t[0]||(t[0]=o("strong",null,"Цена:",-1)),g(" "+p(i.price)+" руб.",1)]),o("p",null,[t[1]||(t[1]=o("strong",null,"ID:",-1)),g(" "+p(i.id),1)])]),o("div",ot,[o("button",{onClick:h=>r.confirmDelete(i.id),class:"delete-btn",disabled:d.deletingId===i.id},[d.deletingId!==i.id?(s(),l("span",dt,"Удалить")):(s(),l("span",it,"Удаление..."))],8,et)])]))),128))])}const st=f(Y,[["render",nt],["__scopeId","data-v-369ef75d"]]),lt={name:"AdminPage",components:{AddProduct:W,ProductList:st},data(){return{loading:!1}},computed:{...w(["products"])},async created(){const e=localStorage.getItem("token"),t=localStorage.getItem("isAdmin")==="true";if(!e||!t){this.$router.replace("/login");return}await this.loadProducts()},methods:{...N(["fetchProducts","deleteProduct","logout"]),async loadProducts(){this.loading=!0;try{await this.fetchProducts()}catch(e){n.Notify.failure("Ошибка загрузки продуктов"),console.error("Ошибка загрузки продуктов:",e)}finally{this.loading=!1}},async handleProductDeleted(e){try{n.Loading.circle("Удаление..."),await this.deleteProduct(e),n.Notify.success("Продукт успешно удален"),await this.loadProducts()}catch(t){n.Notify.failure("Не удалось удалить продукт"),console.error("Ошибка удаления продукта:",t)}finally{n.Loading.remove()}},async handleLogout(){try{n.Loading.circle("Выход..."),await this.logout(),localStorage.removeItem("token"),localStorage.removeItem("isAdmin"),n.Notify.success("Вы успешно вышли"),this.$router.push("/login")}catch(e){n.Notify.failure("Ошибка при выходе"),console.error("Ошибка выхода:",e)}finally{n.Loading.remove()}}}},rt={class:"admin-container"},at={class:"admin-header"},ut={class:"admin-content"},pt={class:"product-management"},ct={class:"product-list-container"},mt={key:0,class:"loading"},vt={key:1,class:"no-products"};function gt(e,t,a,c,d,r){const i=v("router-link"),h=v("AddProduct"),y=v("ProductList");return s(),l("div",rt,[o("header",at,[t[2]||(t[2]=o("h1",null,"Админ панель",-1)),b(i,{to:"/",class:"back-link"},{default:x(()=>t[1]||(t[1]=[g("← На главную")])),_:1}),o("button",{onClick:t[0]||(t[0]=(...k)=>r.handleLogout&&r.handleLogout(...k)),class:"logout-btn"},"Выйти")]),o("div",ut,[o("section",pt,[t[4]||(t[4]=o("h2",null,"Управление продуктами",-1)),b(h,{onProductAdded:r.loadProducts},null,8,["onProductAdded"]),o("div",ct,[t[3]||(t[3]=o("h3",null,"Список продуктов",-1)),d.loading?(s(),l("div",mt,"Загрузка...")):e.products.length===0?(s(),l("div",vt," Нет доступных продуктов ")):(s(),V(y,{key:2,products:e.products,onProductDeleted:r.handleProductDeleted},null,8,["products","onProductDeleted"]))])]),t[5]||(t[5]=o("footer",{class:"company-info"},[o("h3",null,"ТрансЛогистика"),o("div",{class:"contacts"},[o("p",null,[o("strong",null,"Контакты")]),o("p",null,"+7 (XXX) XXX-XX-XX"),o("p",null,"info@translogistika.ru"),o("p",null,"г. Москва, ул. Примерная, 123")]),o("p",{class:"copyright"},"© 2024 ТрансЛогистика. Все права защищены.")],-1))])])}const ht=f(lt,[["render",gt],["__scopeId","data-v-1211a17d"]]);export{ht as default};
