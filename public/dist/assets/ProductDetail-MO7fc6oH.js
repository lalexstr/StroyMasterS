import{a as p}from"./products-Cvr2MWkH.js";import{_ as h,a as e,b as o,e as g,t as n,o as a}from"./index-BIMe63PN.js";const u="/StroyMaster/assets/noImage-CQ6q6lmq.png",m={data(){return{product:null,loading:!1,error:null,imageErrors:{},tonnage:null,totalPrice:0}},computed:{optimizedImageUrl(){var c,l;return(l=(c=this.product)==null?void 0:c.photos)!=null&&l.length?`/${this.product.photos[0].replace(/^\/+/,"")}?w=800&h=800&fit=cover&q=80`:u}},async created(){await this.loadProduct()},methods:{async loadProduct(){this.loading=!0,this.error=null,this.imageErrors={};try{const t=this.$route.params.id;if(!t)throw new Error("ID товара не указан");const r=await p(t);this.product={...r,photos:r.photos?Array.isArray(r.photos)?r.photos:[r.photos]:[]}}catch(t){console.error("Ошибка загрузки товара:",t),this.error=this.getErrorMessage(t)}finally{this.loading=!1}},formatPrice(t){const r=parseFloat(t);return isNaN(r)?"Цена не указана":new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:0,maximumFractionDigits:0}).format(r)},handleImageError(t){t.target.src=u,t.target.classList.add("error-image")},getErrorMessage(t){return t.message.includes("404")?"Товар не найден":t.message.includes("Network Error")?"Ошибка соединения с сервером":"Не удалось загрузить информацию о товаре"},calculate(){if(this.tonnage===null||this.tonnage===""||isNaN(this.product.price)){this.totalPrice=0;return}const t=parseFloat(this.tonnage),r=parseFloat(this.product.price);this.totalPrice=!isNaN(t)&&!isNaN(r)?t*r:0}}},_={key:0,class:"loading"},y={key:1,class:"error"},f={key:2,class:"product-detail"},N={class:"product-content"},I={class:"gallery"},P=["src","alt"],v={key:1,class:"no-photos"},E=["src"],k={class:"product-info"},w={class:"category"},b={class:"manufacturer"},F={class:"description"},U={key:3,class:"not-found"};function B(t,r,c,l,s,i){return s.loading?(a(),e("div",_,r[2]||(r[2]=[o("div",{class:"loader"},null,-1),o("p",null,"Загрузка товара...",-1)]))):s.error?(a(),e("div",y,[g(n(s.error)+" ",1),o("button",{onClick:r[0]||(r[0]=(...d)=>i.loadProduct&&i.loadProduct(...d)),class:"retry-btn"},"Попробовать снова")])):s.product?(a(),e("div",f,[o("div",N,[o("div",I,[s.product.photos&&s.product.photos.length?(a(),e("img",{key:0,src:i.optimizedImageUrl,alt:s.product.name,onError:r[1]||(r[1]=(...d)=>i.handleImageError&&i.handleImageError(...d)),loading:"lazy",class:"gallery-image",width:"400",height:"400"},null,40,P)):(a(),e("div",v,[o("img",{src:t.noImage,class:"no-image-placeholder",alt:"No image",width:"400",height:"400",loading:"lazy"},null,8,E)]))]),o("div",k,[o("h1",null,n(s.product.name),1),r[3]||(r[3]=o("p",{class:"price"},"Запросить цену",-1)),o("p",w,"Категория: "+n(s.product.category_name),1),o("p",b,"Производитель: "+n(s.product.manufacturer_name),1),o("p",F,n(s.product.description||"Описание отсутствует"),1)])])])):(a(),e("div",U," Товар не найден "))}const z=h(m,[["render",B],["__scopeId","data-v-db6c15e2"]]);export{z as default};
